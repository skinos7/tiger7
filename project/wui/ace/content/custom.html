<!-- ajax layout which only needs content area -->
<div class="row">
  <div class="col-xs-12 form-btn-wrapper">
    <!-- PAGE CONTENT BEGINS -->
    <div class="form-horizontal" role="form">



      <!-- 设备信息 -->
      <table class="table table-bordered table-striped">
      <tbody>
          <tr>
              <th data-i18n="SN"></th>
              <th data-i18n="MAC"></th>
              <th data-i18n="IMEI"></th>
              <th data-i18n="ICCID"></th>
              <th data-i18n="Online"></th>
          </tr>
          <tr>
              <td id="list_sn"></td>
              <td id="list_mac"></td>
          </tr>
          <tr id="lte_info" style="display: none;">
              <td id="list_sn1"></td>
              <td id="list_mac1"></td>
              <td id="list_imei1"><i class="ace-icon fa fa-times red"></i></td>
              <td id="list_iccid1"><i class="ace-icon fa fa-times red"></i></td>
              <td id="list_online1"><i class="ace-icon fa fa-times red"></i></td>
          </tr>
          <tr id="lte2_info" style="display: none;">
              <td id="list_sn2"></td>
              <td id="list_mac2"></td>
              <td id="list_imei2"><i class="ace-icon fa fa-times red"></i></td>
              <td id="list_iccid2"><i class="ace-icon fa fa-times red"></i></td>
              <td id="list_online2"><i class="ace-icon fa fa-times red"></i></td>
          </tr>
      </tbody>
      </table>            
      <!-- 设备名称 -->
      <div class="form-group">
        <label class="col-sm-3 control-label no-padding-right" data-i18n="Device Name"></label>
        <div class="col-sm-9">
          <div id="device_name" class="col-xs-10 col-sm-5 form-right-text"></div>
        </div>
      </div>
      <!-- 工作模式 -->
      <div class="form-group">
        <label class="col-sm-3 control-label no-padding-right" data-i18n="Operation Mode"></label>
        <div class="col-sm-9">
          <div id="mode" class="col-xs-10 col-sm-5 form-right-text"></div>
        </div>
      </div>
      <!-- 软件标识 -->
      <div class="form-group">
        <label class="col-sm-3 control-label no-padding-right" data-i18n="Firmware Identifier"></label>
        <div class="col-sm-9">
          <div id="firmware_identify" class="col-xs-10 col-sm-5 form-right-text"></div>
        </div>
      </div>
      <!-- 软件版本 -->
      <div class="form-group">
        <label class="col-sm-3 control-label no-padding-right" data-i18n="Firmware Version"></label>
        <div class="col-sm-9">
          <div id="firmware_version" class="col-xs-10 col-sm-5 form-right-text"></div>
        </div>
      </div>
      <!-- 系统重启 -->
      <div class="form-group">
        <label class="col-sm-3 control-label no-padding-right"></label>
        <div class="col-sm-9">
          <div class="btn-group">
            <button class="btn btn-warning" data-i18n="System Reboot" id="reboot"></button>
          </div>
        </div>
      </div>


      <div class="hr hr32 hr-dotted"></div>
      <!-- 导入LOGO -->
      <div class="form-group">
        <label class="col-sm-3 control-label no-padding-right" data-i18n="Upload Logo File"></label>
        <div class="col-sm-9">
          <div class="col-xs-10 col-sm-5">
            <input type="file" id="upload_logo" />
          </div>
        </div>
      </div>
      <!-- 导入CSS -->
      <div class="form-group">
        <label class="col-sm-3 control-label no-padding-right" data-i18n="Upload CSS File"></label>
        <div class="col-sm-9">
          <div class="col-xs-10 col-sm-5">
            <input type="file" id="upload_css" />
          </div>
        </div>
      </div>

      <div class="hr hr32 hr-dotted"></div>
      <!-- logo color -->
      <div class="form-group">
        <label class="col-sm-3 control-label no-padding-right" data-i18n="Logo Color"></label>
        <div class="col-sm-9">
          <div class="clearfix">
            <input type="text" id="logo_color" class="col-xs-10 col-sm-5" maxlength="128" />
          </div>
        </div>
      </div>
      <!-- logo title -->
      <div class="form-group">
        <label class="col-sm-3 control-label no-padding-right" data-i18n="Logo Title"></label>
        <div class="col-sm-9">
          <div class="clearfix">
            <input type="text" id="logo_title" class="col-xs-10 col-sm-5" maxlength="128" />
          </div>
        </div>
      </div>
      <!-- logo width -->
      <div class="form-group">
        <label class="col-sm-3 control-label no-padding-right" data-i18n="Logo Width"></label>
        <div class="col-sm-9">
          <div class="clearfix">
            <input type="text" id="logo_width" class="col-xs-10 col-sm-5" maxlength="128" />
          </div>
        </div>
      </div>
      <!-- logo height -->
      <div class="form-group">
        <label class="col-sm-3 control-label no-padding-right" data-i18n="Logo Height"></label>
        <div class="col-sm-9">
          <div class="clearfix">
            <input type="text" id="logo_height" class="col-xs-10 col-sm-5" maxlength="128" />
          </div>
        </div>
      </div>
      <!-- Logo Align -->
      <div class="form-group">
        <label class="col-sm-3 control-label no-padding-right" data-i18n="Logo Align"></label>
        <div class="col-sm-9">
          <select class="col-xs-10 col-sm-5" id="auth">
            <option value="center" data-i18n="Center"></option>
            <option value="right" data-i18n="Right"></option>
          </select>
        </div>
      </div>
      <!-- Logo Model -->
      <div class="form-group">
        <label class="col-sm-3 control-label no-padding-right" data-i18n="Show Logo Model"></label>
        <div class="col-sm-9">
          <label>
            <input id="logo_model" class="ace ace-switch ace-switch-6" type="checkbox" />
            <span class="lbl"></span>
          </label>
        </div>
      </div>
      <!-- Model Bar -->
      <div class="form-group">
        <label class="col-sm-3 control-label no-padding-right" data-i18n="Show Model Bar"></label>
        <div class="col-sm-9">
          <label>
            <input id="nav_bar" class="ace ace-switch ace-switch-6" type="checkbox" />
            <span class="lbl"></span>
          </label>
        </div>
      </div>

      <!-- Copyright -->
      <div class="form-group">
        <label class="col-sm-3 control-label no-padding-right" data-i18n="Show Copyright"></label>
        <div class="col-sm-9">
          <label>
            <input id="copyright" class="ace ace-switch ace-switch-6" type="checkbox" />
            <span class="lbl"></span>
          </label>
        </div>
      </div>
      <!-- Fireware Identify -->
      <div class="form-group">
        <label class="col-sm-3 control-label no-padding-right" data-i18n="Show Fireware Identify"></label>
        <div class="col-sm-9">
          <label>
            <input id="firmware_id" class="ace ace-switch ace-switch-6" type="checkbox" />
            <span class="lbl"></span>
          </label>
        </div>
      </div>
      <!-- Upgrade Online -->
      <div class="form-group">
        <label class="col-sm-3 control-label no-padding-right" data-i18n="Show Upgrade Online"></label>
        <div class="col-sm-9">
          <label>
            <input id="upgrade_online" class="ace ace-switch ace-switch-6" type="checkbox" />
            <span class="lbl"></span>
          </label>
        </div>
      </div> 
      <!-- Repo Online -->
      <div class="form-group">
        <label class="col-sm-3 control-label no-padding-right" data-i18n="Show Repo Online"></label>
        <div class="col-sm-9">
          <label>
            <input id="repo_online" class="ace ace-switch ace-switch-6" type="checkbox" />
            <span class="lbl"></span>
          </label>
        </div>
      </div> 
      <!-- Development Menu -->
      <div class="form-group">
        <label class="col-sm-3 control-label no-padding-right" data-i18n="Show Development Menu"></label>
        <div class="col-sm-9">
          <label>
            <input id="development" class="ace ace-switch ace-switch-6" type="checkbox" />
            <span class="lbl"></span>
          </label>
        </div>
      </div> 

      <!-- 应用 -->
      <div class="form-horizontal" role="form">
        <div class="form-group">
          <label class="col-sm-3 control-label no-padding-right"></label>
          <div class="col-sm-9">
            <div class="btn-group">
              <button class="btn btn-main" data-i18n="Apply Above Configure" id="apply"></button>
            </div>
          </div>
        </div>
      </div>



      <div class="hr hr32 hr-dotted"></div>
      <!-- 客户型号 -->
      <div class="form-group">
          <label class="col-sm-3 control-label no-padding-right" data-i18n="Custom Model"></label>
          <div class="col-sm-9">
              <input type="text" id="cmodel_string" class="col-xs-10 col-sm-5" maxlength="128" />
              &nbsp;&nbsp;&nbsp;
              <button class="btn btn-mini btn-main" id="cmodel_modify" data-i18n="Modify"></button>
          </div>
      </div>
      <!-- 配置版本 -->
      <div class="form-group">
          <label class="col-sm-3 control-label no-padding-right" data-i18n="Configure Version"></label>
          <div class="col-sm-9">
            <div id="cfgversion" class="col-xs-10 col-sm-5 form-right-text"></div>
          </div>
      </div>
      <div class="form-horizontal" role="form">
        <div class="form-group">
          <label class="col-sm-3 control-label no-padding-right"></label>
          <div class="col-sm-9">
            <div class="btn-group">
              <button class="btn btn-warning" data-i18n="Default Configure" id="default"></button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- 导入配置 -->
      <div class="form-group">
        <label class="col-sm-3 control-label no-padding-right" data-i18n="Restore Default Configure"></label>
        <div class="col-sm-9">
          <div class="col-xs-10 col-sm-5">
            <input type="file" id="restore_default" />
          </div>
        </div>
      </div>
      <!-- 恢复出厂设置 -->
      <div class="form-horizontal" role="form">
        <div class="form-group">
          <label class="col-sm-3 control-label no-padding-right"></label>
          <div class="col-sm-9">
            <div class="btn-group">
              <button class="btn btn-inverse" data-i18n="Save Default Configure" id="save_default"></button>
              <button class="btn btn-danger" data-i18n="Factory Configure" id="factory"></button>
            </div>
          </div>
        </div>
      </div>
  




    </div>
    <!-- PAGE CONTENT ENDS -->
  </div><!-- /.col -->
</div><!-- /.row -->

<!-- page specific plugin scripts -->
<script type="text/javascript">
  (function () {
    var sn;
    var m;
    var ms;
    var lte;
    var lte2;
    var ltes;
    var lte2s;
    var ethernets;
    var wui;
    function load_cfg()
    {
        he.load( [ "machine", "machine.status", ".ifname@lte", ".ifname@lte2", "ifname@lte.status", "ifname@lte2.status", "arch@ethernet.status", "wui@admin" ] ).then( function( v ){
            m = v[0]
            ms = v[1];
            lte = v[2];
            lte2 = v[3];
            ltes = v[4];
            lte2s = v[5];
            ethernets = v[6];
            wui = v[7];

            if ( m["sn"] )
            {
                sn = m["sn"];
            }
            else
            {
                sn = ms.datecode+""+ms.model+""+ms.macid.substring(6);
            }
            $('#list_mac').text( ms.mac );
            $('#list_sn').text( sn );
            if ( lte == true )
            {
                $('#lte_info').show();
                $('#list_mac1').text( ms.mac );
                $('#list_sn1').text( sn );
                if ( ltes.imei )
                {
                $('#list_imei1').text( ltes.imei );
                }
                if ( ltes.iccid && ltes.iccid != "nosim" )
                {
                    $('#list_iccid1').text( ltes.iccid );
                }
                if ( ltes.status == "up" )
                {
                    $('#list_online1').html( '<i class="ace-icon fa fa-check green"></i>' );
                }
                else
                {
                    $('#list_online1').html( '<i class="ace-icon fa fa-times red"></i>' );
                }
            }
            if ( lte2 == true )
            {
                $('#lte2_info').show();
                $('#list_mac2').text( ms.mac );
                $('#list_sn2').text( sn );

                if ( lte2s.imei )
                {
                $('#list_imei2').text( lte2s.imei );
                }
                if ( lte2s.iccid && lte2s.iccid != "nosim" )
                {
                    $('#list_iccid2').text( lte2s.iccid );
                }
                if ( lte2s.status == "up" )
                {
                    $('#list_online2').html( '<i class="ace-icon fa fa-check green"></i>' );
                }
                else
                {
                    $('#list_online2').html( '<i class="ace-icon fa fa-times red"></i>' );
                }
            }

            /* load the software */
            $('#device_name').text( m.name );
            $("#mode").text( $.i18n(m.mode) );
            $('#firmware_identify').text( ms.hardware+"-"+ms.custom+"-"+ms.scope );
            $('#firmware_version').text(ms.version);

            /* load wui */
            $('#logo_color').val( wui.logo_color );
            $('#logo_title').val( wui.logo_title );
            $('#logo_width').val( wui.logo_width );
            $('#logo_height').val( wui.logo_height );
            $('#logo_align').val( wui.logo_align );
            if ( wui.logo_model == "disable" )
            {
                $('#logo_model').prop('checked', false );
            }
            else
            {
                $('#logo_model').prop('checked', true );
            }
            if ( wui.nav_bar == "disable" )
            {
                $('#nav_bar').prop('checked', false );
            }
            else
            {
                $('#nav_bar').prop('checked', true );
            }
            if ( wui.copyright == "disable" )
            {
                $('#copyright').prop('checked', false );
            }
            else
            {
                $('#copyright').prop('checked', true );
            }
            if ( wui.firmware_id == "disable" )
            {
                $('#firmware_id').prop('checked', false );
            }
            else
            {
                $('#firmware_id').prop('checked', true );
            }
            if ( wui.upgrade_online == "disable" )
            {
                $('#upgrade_online').prop('checked', false );
            }
            else
            {
                $('#upgrade_online').prop('checked', true );
            }
            if ( wui.repo_online == "disable" )
            {
                $('#repo_online').prop('checked', false );
            }
            else
            {
                $('#repo_online').prop('checked', true );
            }
            if ( wui.menu )
            {
                if ( wui.menu.development == "disable" )
                {
                    $('#development').prop('checked', false );
                }
                else
                {
                    $('#development').prop('checked', true );
                }
            }
            else
            {
                $('#development').prop('checked', true );
            }

            /* load the config */
            $('#cmodel_string').val( ms.cmodel );
            $('#cfgversion').text(ms.cfgversion||$.i18n('Default'));

        });
    }
    $.i18n().load( page.lang('device') ).then( function () {

        /* init the langauage */
        $.i18n().locale = lang; $('body').i18n();


        // 系统重启
        $('#reboot').on(ace.click_event, function () {
            he.reboot( { title: $.i18n('Restarting...'), hint:$.i18n('Make sure that the device is reconnected') } );
        });


        /* LOGO文件导入 */
        $('#upload_logo').ace_file_input( { no_file: $.i18n('No File'), btn_choose: $.i18n('Choose'), btn_change: $.i18n('Change'), icon_remove: '' } );
        $('#upload_logo').fileupload({
            url: '/cgi/upload?PROJECT=wui&FILETYPE=config&FILENAME=logo.png',
            paramName: 'filename',
            dataType: 'text',
            add: function (e, data)
            {
                page.overlay($.i18n('Importing...'));
                data.submit();
            },
            done: function (e, data)
            {
                page.overlay2hide();
                he.exec( [ "wui@admin:logo_file=logo.png" ] ).then( function(){
                    location.reload(true);
                });
            }
        });
        /* CSS文件导入 */
        $('#upload_css').ace_file_input( { no_file: $.i18n('No File'), btn_choose: $.i18n('Choose'), btn_change: $.i18n('Change'), icon_remove: '' } );
        $('#upload_css').fileupload({
            url: '/cgi/upload?PROJECT=wui&FILETYPE=config&FILENAME=custom.css',
            paramName: 'filename',
            dataType: 'text',
            add: function (e, data)
            {
                page.overlay($.i18n('Importing...'));
                data.submit();
            },
            done: function (e, data)
            {
                page.overlay2hide();
                he.exec( [ "wui@admin:css_file=custom.css" ] ).then( function(){
                    location.reload(true);
                });
            }
        });
        /* bind the apply to save configure */
        $('#apply').on(ace.click_event, function () {
            if ( wui == null )
            {
                return;
            }
            wui.logo_color = $('#logo_color').val();
            wui.logo_title = $('#logo_title').val();
            wui.logo_width = $('#logo_width').val();
            wui.logo_height = $('#logo_height').val();
            wui.logo_align = $('#logo_align').val();
            wui.logo_model = boole2able( $('#logo_model').prop('checked') );
            wui.nav_bar = boole2able( $('#nav_bar').prop('checked') );
            wui.copyright = boole2able( $('#copyright').prop('checked') );
            wui.firmware_id = boole2able( $('#firmware_id').prop('checked') );
            wui.upgrade_online = boole2able( $('#upgrade_online').prop('checked') );
            wui.repo_online = boole2able( $('#repo_online').prop('checked') );
            if ( !wui.menu )
            {
                wui.menu = {};
            }
            if ( $('#development').prop('checked') == true )
            {
                wui.menu.development = "enable";
            }
            else
            {
                wui.menu.development = "disable";
            }
            he.exec( [ "wui@admin="+JSON.stringify(wui) ] ).then( function(){
                location.reload(true);
            });
        });


        // 恢复默认设置
        $('#default').on(ace.click_event, function () {
            he.exec( "arch@data.default" ).then( function(result){location.reload();} );
        });
        // 导入默认配置
        $('#restore_default').ace_file_input( { no_file: $.i18n('No File'), btn_choose: $.i18n('Choose'), btn_change: $.i18n('Change'), icon_remove: '' } );
        $('#restore_default').fileupload({
            url: '/cgi/restore_default',
            paramName: 'filename',
            dataType: 'text',
            add: function (e, data)
            {
                // 提示正在导入配置
                page.overlay($.i18n('Restore...'));
                // 执行导入
                data.submit();
            },
            done: function (e, data)
            {
                var result = JSON.parse(data.result);
                // 隐藏遮罩
                page.overlay2hide();
                if ( result.status === 'success')
                { // 导入成功重启
                    he.reboot( { title: $.i18n('Restore the configuration is successful, now restarting...'), hint:$.i18n('Make sure that the device is reconnected') } );
                    
                }
                else
                {
                    // 提示升级失败
                    page.alert( { message: $.i18n('Restore Failure') } ).then( function(){ location.reload(); } );
                }
            }
        });
        // 保存默认配置
        $('#save_default').click(function () {
            he.exec( [ "arch@data.current_default" ] ).then( function(v){
                var ret = v[0];
                if ( ret == true )
                {
                    page.alert( { message: $.i18n('Save configure to default succeed'), callback: function( result ){location.reload();} } );
                }
                else
                {
                    page.alert( { message: $.i18n('Save configure to default failed') } );
                }
            });
        });
        // 恢复出厂设置
        $('#factory').on(ace.click_event, function () {
            he.exec( "arch@data.factory" ).then( function(result){location.reload();} );
        });



        $('#cmodel_modify').click(function () {
            var nmodel = $("#cmodel_string").val();
            if ( nmodel != ms.cmodel )
            {
                he.exec( [ "arch@data:cmodel="+nmodel ] ).then( function(){
                    location.reload(true);
                });
            }
            else
            {
                page.alert( { message: $.i18n('Settings unchanged') } );
                return;
            }
        });



        /* load the configure */
        load_cfg();
        /* bind the refresh */
        $('#refresh').on(ace.click_event, function () {
            location.reload();
        });
    });



  })();
</script>



