<!-- ajax layout which only needs content area -->
<div class="row" id="page-modes">
  <div class="col-xs-12 form-btn-wrapper">
    <!-- PAGE CONTENT BEGINS -->
    <div class="form-horizontal" role="form">

        <!-- 连接状态 -->
        <table class="table table-bordered table-striped">
        <tbody>
            <tr>
                <th data-i18n="Status"></th>
                <td>
                    <span id="wan_status"></span>&nbsp; &nbsp;
                    <a class="btn btn-mini btn-warning" id="wan_btn"><i class="ace-icon fa fa-pause"></i></a>&nbsp;
                </td>
                <th data-i18n="IPv4 Address"></th><td id="wan_ip"></td>
            </tr>
            <tr>
                <th data-i18n="MAC Address"></th><td id="wan_mac"></td> <th data-i18n="Gateway"></th><td id="wan_gateway"></td> 
            </tr>
            <tr>
                <th data-i18n="Online Time"></th><td id="wan_livetime"></td> <th data-i18n="DNS"></th><td id="wan_dns"></td>
            </tr>
            <tr>
                <th data-i18n="Rx/Tx"></th><td id="wan_rxtx"></td> <th data-i18n="DNS2"></th><td id="wan_dns2"></td>
            </tr>
        </tbody>
        </table>            



        <div class="hr hr32 hr-dotted"></div>
        <!-- 网络功能 -->
        <div class="form-group">
          <label class="col-sm-3 control-label no-padding-right" data-i18n="Status"></label>
          <div class="col-sm-9">
            <label>
              <input id="status" class="ace ace-switch ace-switch-6" type="checkbox" />
              <span class="lbl"></span>
            </label>
          </div>
        </div>
        <div id="status_config" style="display: none;" >

            <!-- IPV4拨号模式 -->
            <div class="form-group">
              <label class="col-sm-3 control-label no-padding-right" data-i18n="IPv4 Mode"></label>
              <div class="col-sm-9">
                <select class="col-xs-10 col-sm-5" id="mode">
                  <option value="pppoec" data-i18n="PPPOE"></option>
                  <option value="dhcpc" data-i18n="DHCP"></option>
                  <option value="static" data-i18n="Static IP"></option>
                </select>
              </div>
            </div>

            <!-- dhcpc设置-->
            <div id="dhcpc_cfg" style="display: none;" >
                <!-- 开启route选项支持 -->
                <div class="form-group">
                  <label class="col-sm-3 control-label no-padding-right" data-i18n="Route Options"></label>
                  <div class="col-sm-9">
                    <label>
                      <input id="routeopt" class="ace ace-switch ace-switch-6" type="checkbox" />
                      <span class="lbl"></span>
                    </label>
                  </div>
                </div>
            </div>

            <!-- Static设置-->
            <div id="static_cfg" style="display: none;" >
                <!-- IP地址 -->
                <div class="form-group">
                    <label class="col-sm-3 control-label no-padding-right" data-i18n="IPv4 Address"></label>
                    <div class="col-sm-9">
                      <div class="clearfix">
                        <input type="text" id="ip" class="col-xs-10 col-sm-5" maxlength="128" />
                      </div>
                    </div>
                </div>
                <!-- 掩码 -->
                <div class="form-group">
                    <label class="col-sm-3 control-label no-padding-right" data-i18n="Subnet Mask"></label>
                    <div class="col-sm-9">
                      <div class="clearfix">
                        <input type="text" id="mask" class="col-xs-10 col-sm-5" maxlength="128" />
                      </div>
                    </div>
                </div>
                <!-- 网关 -->
                <div class="form-group">
                  <label class="col-sm-3 control-label no-padding-right" data-i18n="Gateway"></label>
                  <div class="col-sm-9">
                    <div class="clearfix">
                      <input type="text" id="gw" class="col-xs-10 col-sm-5" maxlength="128" />
                    </div>
                  </div>
                </div>
                <!-- DNS -->
                <div class="form-group">
                  <label class="col-sm-3 control-label no-padding-right" data-i18n="DNS"></label>
                  <div class="col-sm-9">
                    <div class="clearfix">
                      <input type="text" id="dns" class="col-xs-10 col-sm-5" maxlength="128" />
                    </div>
                  </div>
                </div>
                <!-- DNS2 -->
                <div class="form-group">
                  <label class="col-sm-3 control-label no-padding-right" data-i18n="DNS2"></label>
                  <div class="col-sm-9">
                    <div class="clearfix">
                      <input type="text" id="dns2" class="col-xs-10 col-sm-5" maxlength="128" />
                    </div>
                  </div>
                </div>
            </div> <!-- static_cfg -->

            <!-- PPPOE设置-->
            <div id="pppoe_cfg" style="display: none;" >

                <!-- 拨号用户名 -->
                <div class="form-group">
                  <label class="col-sm-3 control-label no-padding-right" data-i18n="Username"></label>
                  <div class="col-sm-9">
                    <input type="text" id="username" class="col-xs-10 col-sm-5" maxlength="128" />
                  </div>
                </div>
                <!-- 拨号密码 -->
                <div class="form-group">
                  <label class="col-sm-3 control-label no-padding-right" data-i18n="Password"></label>
                  <div class="col-sm-9">
                    <span class="input-icon input-icon-right input-icon-form col-xs-10 col-sm-5">
                      <input type="password" id="password" maxlength="128" autocomplete="new-password" />
                      <i class="ace-icon fa fa-eye-slash" id="password-icon"></i>
                    </span>
                  </div>
                </div>
            
                <!-- lcp 间隔 -->
                <div class="form-group">
                    <label class="col-sm-3 control-label no-padding-right" data-i18n="LCP Echo Interval"></label>
                    <div class="col-sm-9">
                      <input type="text" id="lcp_echo_interval" class="col-xs-10 col-sm-5" maxlength="128" />
                    </div>
                </div>
                <!-- lcp 失败次数 -->
                <div class="form-group">
                    <label class="col-sm-3 control-label no-padding-right" data-i18n="LCP Echo Times"></label>
                    <div class="col-sm-9">
                      <input type="text" id="lcp_echo_failure" class="col-xs-10 col-sm-5" maxlength="128" />
                    </div>
                </div>
            </div> <!-- pppoe_cfg -->

            <!-- 自定义DNS -->
            <div id="customdns_cfg" style="display: none;">
                <div class="form-group">
                  <label class="col-sm-3 control-label no-padding-right" data-i18n="Custom DNS"></label>
                  <div class="col-sm-9">
                    <label>
                      <input id="custom_dns" class="ace ace-switch ace-switch-6" type="checkbox" />
                      <span class="lbl"></span>
                    </label>
                  </div>
                </div>
                <div id="customdns_config" style="display: none;">
                  <!-- DNS -->
                  <div class="form-group">
                    <label class="col-sm-3 control-label no-padding-right" data-i18n="DNS"></label>
                    <div class="col-sm-9">
                      <input type="text" id="cdns" class="col-xs-10 col-sm-5" maxlength="128" />
                    </div>
                  </div>
                  <!-- DNS2 -->
                  <div class="form-group">
                    <label class="col-sm-3 control-label no-padding-right" data-i18n="DNS2"></label>
                    <div class="col-sm-9">
                      <input type="text" id="cdns2" class="col-xs-10 col-sm-5" maxlength="128" />
                    </div>
                  </div>
                </div>
            </div><!-- customdns_cfg -->
              
            <!-- IP伪装 -->
            <div class="form-group">
                <label class="col-sm-3 control-label no-padding-right" data-i18n="IPv4 Masquerade(NAT)"></label>
                <div class="col-sm-9">
                    <label>
                        <input id="masq" class="ace ace-switch ace-switch-6" type="checkbox" />
                        <span class="lbl"></span>
                    </label>
                </div>
            </div>
            <!-- mtu -->
            <div class="form-group">
                <label class="col-sm-3 control-label no-padding-right" data-i18n="MTU"></label>
                <div class="col-sm-9">
                    <input type="text" id="mtu" class="col-xs-10 col-sm-5" maxlength="128" />
                </div>
            </div>







          <div id="ipv6_cfg" style="display: none;" >
      
              <div class="hr hr32 hr-dotted"></div>
              <!-- IPV6拨号模式 -->
              <div class="form-group">
                <label class="col-sm-3 control-label no-padding-right" data-i18n="IPv6 Mode"></label>
                <div class="col-sm-9">
                  <select class="col-xs-10 col-sm-5" id="method">
                    <option value="disable" data-i18n="Disable"></option>
                    <!-- <option value="slaac" data-i18n="SLAAC"></option> -->
                    <option value="automatic" data-i18n="Automatic"></option>
                    <option value="manual" data-i18n="Manual"></option>
                  </select>
                </div>
              </div>
      
              <!-- Manual设置-->
              <div id="manual_cfg" style="display: none;" >
                  <!-- IPV6地址 -->
                  <div class="form-group">
                      <label class="col-sm-3 control-label no-padding-right" data-i18n="IPv6 Address"></label>
                      <div class="col-sm-9">
                        <div class="clearfix">
                          <input type="text" id="addr" class="col-xs-10 col-sm-5" maxlength="128" />
                        </div>
                      </div>
                  </div>
            
                  <!-- 掩码 -->
                  <div class="form-group">
                      <label class="col-sm-3 control-label no-padding-right" data-i18n="Subnet Prefix"></label>
                      <div class="col-sm-9">
                        <div class="clearfix">
                          <input type="text" id="prefix" class="col-xs-10 col-sm-5" maxlength="128" />
                        </div>
                      </div>
                  </div>
                  <!-- 网关 -->
                  <div class="form-group">
                    <label class="col-sm-3 control-label no-padding-right" data-i18n="Next Hop"></label>
                    <div class="col-sm-9">
                      <div class="clearfix">
                        <input type="text" id="hop" class="col-xs-10 col-sm-5" maxlength="128" />
                      </div>
                    </div>
                  </div>
            
                  <!-- DNS -->
                  <div class="form-group">
                    <label class="col-sm-3 control-label no-padding-right" data-i18n="DNS"></label>
                    <div class="col-sm-9">
                      <div class="clearfix">
                        <input type="text" id="resolve" class="col-xs-10 col-sm-5" maxlength="128" />
                      </div>
                    </div>
                  </div>
            
                  <!-- DNS2 -->
                  <div class="form-group">
                    <label class="col-sm-3 control-label no-padding-right" data-i18n="DNS2"></label>
                    <div class="col-sm-9">
                      <div class="clearfix">
                        <input type="text" id="resolve2" class="col-xs-10 col-sm-5" maxlength="128" />
                      </div>
                    </div>
                  </div>
              </div> <!-- manual_cfg -->
          </div> <!-- ipv6_cfg -->







          <div class="hr hr32 hr-dotted"></div>
          <!-- 保活模式 -->
          <div class="form-group">
            <label class="col-sm-3 control-label no-padding-right" data-i18n="Availability Check"></label>
            <div class="col-sm-9">
              <select class="col-xs-10 col-sm-5" id="keeplive">
                <option value="disable" data-i18n="Disable"></option>
                <option value="icmp" data-i18n="ICMP"></option>
                <option value="dns" data-i18n="UDP&TCP"></option>
                <option value="recv" data-i18n="Receive Count"></option>
                <option value="auto" data-i18n="Auto"></option>
              </select>
            </div>
          </div>
          <!-- icmp配置 -->
          <div id="icmp_cfg" style="display: none;">
            <!-- 地址 -->
            <div class="form-group">
              <label class="col-sm-3 control-label no-padding-right" data-i18n="Test Address"></label>
              <div class="col-sm-9">
                <div class="clearfix">
                  <input type="text" id="icmp_test" class="col-xs-10 col-sm-5" maxlength="128" />
                </div>
              </div>
            </div>
            <!-- 地址2 -->
            <div class="form-group">
              <label class="col-sm-3 control-label no-padding-right" data-i18n="Test Address 2"></label>
              <div class="col-sm-9">
                <input type="text" id="icmp_test2" class="col-xs-10 col-sm-5" maxlength="128" />
              </div>
            </div>
            <!-- 地址3 -->
            <div class="form-group">
              <label class="col-sm-3 control-label no-padding-right" data-i18n="Test Address 3"></label>
              <div class="col-sm-9">
                <input type="text" id="icmp_test3" class="col-xs-10 col-sm-5" maxlength="128" />
              </div>
            </div>
            <!-- 超时 -->
            <div class="form-group">
              <label class="col-sm-3 control-label no-padding-right" data-i18n="Each Query Timeout(sec)"></label>
              <div class="col-sm-9">
                <input type="text" id="icmp_timeout" class="col-xs-10 col-sm-5" maxlength="128" />
              </div>
            </div>
            <!-- 次数 -->
            <div class="form-group">
              <label class="col-sm-3 control-label no-padding-right" data-i18n="Test Times"></label>
              <div class="col-sm-9">
                <input type="text" id="icmp_failed" class="col-xs-10 col-sm-5" maxlength="128" />
              </div>
            </div>
            <!-- 间隔 -->
            <div class="form-group">
              <label class="col-sm-3 control-label no-padding-right" data-i18n="Test Interval(sec)"></label>
              <div class="col-sm-9">
                <input type="text" id="icmp_interval" class="col-xs-10 col-sm-5" maxlength="128" />
              </div>
            </div>
          </div><!-- icmp_cfg -->
          <div id="dns_cfg" style="display: none;">
            <!-- 超时 -->
            <div class="form-group">
              <label class="col-sm-3 control-label no-padding-right" data-i18n="Each Query Timeout(sec)"></label>
              <div class="col-sm-9">
                <input type="text" id="dns_timeout" class="col-xs-10 col-sm-5" maxlength="128" />
              </div>
            </div>
            <!-- 次数 -->
            <div class="form-group">
              <label class="col-sm-3 control-label no-padding-right" data-i18n="Query Times"></label>
              <div class="col-sm-9">
                <input type="text" id="dns_failed" class="col-xs-10 col-sm-5" maxlength="128" />
              </div>
            </div>
            <!-- 间隔 -->
            <div class="form-group">
              <label class="col-sm-3 control-label no-padding-right" data-i18n="Query Interval(sec)"></label>
              <div class="col-sm-9">
                <input type="text" id="dns_interval" class="col-xs-10 col-sm-5" maxlength="128" />
              </div>
            </div>
          </div>
          <!-- Receive配置 -->
          <div id="recv_cfg" style="display: none;">
            <!-- 超时 -->
            <div class="form-group">
              <label class="col-sm-3 control-label no-padding-right" data-i18n="Count Duration(sec)"></label>
              <div class="col-sm-9">
                <input type="text" id="recv_timeout" class="col-xs-10 col-sm-5" maxlength="128" />
              </div>
            </div>
            <!-- 次数 -->
            <div class="form-group">
              <label class="col-sm-3 control-label no-padding-right" data-i18n="Count Times"></label>
              <div class="col-sm-9">
                <input type="text" id="recv_failed" class="col-xs-10 col-sm-5" maxlength="128" />
              </div>
            </div>
            <!-- 包数 -->
            <div class="form-group">
              <label class="col-sm-3 control-label no-padding-right" data-i18n="Received packets"></label>
              <div class="col-sm-9">
                <input type="text" id="recv_packets" class="col-xs-10 col-sm-5" maxlength="128" />
              </div>
            </div>
          </div>



      </div>



      

      <div class="clearfix form-actions">
        <div class="col-md-offset-3 col-md-9">
          <button class="btn btn-second" type="button" id="refresh"><span data-i18n="Refresh"></span></button>
          &nbsp; &nbsp; &nbsp;
          <button class="btn btn-main" type="button" id="apply"><span data-i18n="Apply"></span></button>
        </div>
      </div>


    </div>
    <!-- PAGE CONTENT ENDS -->
  </div><!-- /.col -->
</div><!-- /.row -->



<!-- page specific plugin scripts -->
<script type="text/javascript">
  (function () {
    /* get the object */
    var wan;
    var wans;
    var object = "ifname@wan";
    var index = page.param( 'object', location.hash );
    if ( index )
    {
        object = index;
    }
    /* load the status */
    function status_load()
    {
      he.bkload( [ object+".status" ] ).then( function(v){
          wans = v[0];
          var info = wans;
          var id = "#wan";
          /* status end btn */
          if ( info.status )
          {
              $(id).show();
              $(id+"_btn").html( '<i class="ace-icon fa fa-pause"></i>' );
              $(id+"_status").text( $.i18n(info.status) );
              if ( info.status == "up" || info.status == "uping" )
              {
              }
              else
              {
                  $(id+"_btn").html( '<i class="ace-icon fa fa-play"></i>' );
              }
          }
          else
          {
              $(id+"_btn").html( '<i class="ace-icon fa fa-play"></i>' );
              $(id+"_status").text( $.i18n("down") );
          }
          if ( !info.gw || info.gw == "0.0.0.0" )
          {
              $(id+"_gateway").text( info.dstip||' ' );
          }
          else
          {
              $(id+"_gateway").text( info.gw||' ' );
          }
          $(id+"_dns").text( info.dns||' ' );
          $(id+"_dns2").text( info.dns2||' ' );
          $(id+"_mac").text( info.mac||' ' );
          /* network */
          $(id+"_ip").text( info.ip||' ' );
          $(id+"_rxtx").text( byte2readable( (info.rx_bytes||"0") ) + " / " + byte2readable( (info.tx_bytes||"0") ) );
          $(id+"_livetime").text( info.livetime||' ' );
      })
    }


    
    /* load the configure on the input */
    function config_load()
    {
      he.load( [ object ] ).then( function(v){
        wan = v[0];
        /* status */
        if ( wan.status && wan.status == "disable" )
        {
            $('#status').prop('checked', false );
        }
        else
        {
            $('#status').prop('checked', true );
        }
        $('#status').unbind('change').change(function () {
          if ($(this).prop('checked'))
          {
            $('#status_config').show();
          }
          else
          {
            $('#status_config').hide();
          }
        }).trigger('change');
        /* IPV4 */
        $('#mode').val( wan.mode || 'dhcpc' );
        if ( wan.pppoec )
        {
          $('#username').val(wan.pppoec.username);
          $('#password').val(wan.pppoec.password);
          $('#lcp_echo_interval').val(wan.pppoec.lcp_echo_interval);
          $('#lcp_echo_failure').val(wan.pppoec.lcp_echo_failure);
        }
        if ( wan.dhcpc )
        {
            $('#routeopt').prop('checked', able2boole(wan.dhcpc.routeopt) );
        }
        if ( wan.static )
        {
          $('#ip').val(wan.static.ip);
          $('#mask').val(wan.static.mask);
          $('#gw').val(wan.static.gw);
          $('#dns').val(wan.static.dns);
          $('#dns2').val(wan.static.dns2);
        }
        $('#masq').prop('checked', able2boole(wan.masq));
        $('#mtu').val(wan.mtu||"");
        $('#mode').unbind('change').change(function (e) {
          var type = e.target.value;
          switch (type)
          {
            case 'static':
              $('#dhcpc_cfg').hide();
              $('#static_cfg').show();
              $('#pppoe_cfg').hide();
              $('#customdns_cfg').hide();
              break;
            case 'dhcpc':
              $('#dhcpc_cfg').show();
              $('#static_cfg').hide();
              $('#pppoe_cfg').hide();
              $('#customdns_cfg').show();
              if ( wan.dhcpc )
              {
                $('#custom_dns').prop('checked', able2boole(wan.dhcpc.custom_dns));
                $('#cdns').val( wan.dhcpc.dns );
                $('#cdns2').val( wan.dhcpc.dns2 );
              }
              if ($('#custom_dns').prop('checked'))
              {
                $('#customdns_config').show();
              }
              else
              {
                $('#customdns_config').hide();
              }
              break;
            case 'pppoec':
              $('#dhcpc_cfg').hide();
              $('#static_cfg').hide();
              $('#pppoe_cfg').show();
              $('#customdns_cfg').show();
              if ( wan.pppoec )
              {
                $('#custom_dns').prop('checked', able2boole(wan.pppoec.custom_dns));
                $('#cdns').val( wan.pppoec.dns );
                $('#cdns2').val( wan.pppoec.dns2 );
              }
              if ($('#custom_dns').prop('checked'))
              {
                $('#customdns_config').show();
              }
              else
              {
                $('#customdns_config').hide();
              }
              break;
          }
        }).trigger('change');
        $('#custom_dns').unbind('change').change(function () {
          if ($(this).prop('checked'))
          {
            $('#customdns_config').show();
          }
          else
          {
            $('#customdns_config').hide();
          }
        }).trigger('change');
        /* IPV6 */
        if ( wan.method )
        {
            $('#ipv6_cfg').show();
            $('#method').val(wan.method);
            if ( wan.manual )
            {
              if ( wan.manual.addr )
              {
                $('#addr').val(wan.manual.addr);
                $('#prefix').val(wan.manual.prefix);
              }
              $('#hop').val(wan.manual.hop);
              $('#resolve').val(wan.manual.resolve);
              $('#resolve2').val(wan.manual.resolve2);
            }
        }
        $('#method').unbind('change').change(function (e) {
          var type = e.target.value;
          switch (type)
          {
            case 'disable':
            case 'slaac':
            case 'automatic':
                $('#manual_cfg').hide();
                break;
            case 'manual':
              $('#manual_cfg').show();
              break;
          }
        }).trigger('change');
        /* Keeplive */
        if ( wan.keeplive )
        {
            $('#keeplive').val( wan.keeplive.type || 'disable');
            if ( wan.keeplive.icmp )
            {
              if (wan.keeplive.icmp.dest)
              {
                $('#icmp_test').val(wan.keeplive.icmp.dest.test)
                $('#icmp_test2').val(wan.keeplive.icmp.dest.test2)
                $('#icmp_test3').val(wan.keeplive.icmp.dest.test3)
              }
              $('#icmp_timeout').val(wan.keeplive.icmp.timeout);
              $('#icmp_failed').val(wan.keeplive.icmp.failed);
              $('#icmp_interval').val(wan.keeplive.icmp.interval);
            }
            if ( wan.keeplive.dns )
            {
              $('#dns_timeout').val(wan.keeplive.dns.timeout);
              $('#dns_failed').val(wan.keeplive.dns.failed);
              $('#dns_interval').val(wan.keeplive.dns.interval);
            }
            if ( wan.keeplive.recv )
            {
              $('#recv_timeout').val(wan.keeplive.recv.timeout);
              $('#recv_failed').val(wan.keeplive.recv.failed);
              $('#recv_packets').val(wan.keeplive.recv.packets);
            }
        }
        else
        {
            $('#keeplive').val( 'disable');
        }
        $('#keeplive').unbind('change').change(function (e) {
          var type = e.target.value;
          switch (type)
          {
              case 'disable':
                $('#icmp_cfg').hide();
                $('#dns_cfg').hide();
                $('#recv_cfg').hide();
                break;
              case 'icmp':
                $('#icmp_cfg').show();
                $('#dns_cfg').hide();
                $('#recv_cfg').hide();
                break;
              case 'dns':
                $('#icmp_cfg').hide();
                $('#dns_cfg').show();
                $('#recv_cfg').hide();
                break;
              case 'recv':
                $('#icmp_cfg').hide();
                $('#dns_cfg').hide();
                $('#recv_cfg').show();
                break;
              case 'auto':
                $('#icmp_cfg').hide();
                $('#dns_cfg').show();
                $('#recv_cfg').show();
                break;
          }
        }).trigger('change');

      })
    }



    /* save the configure */
    function config_save()
    {
      if ( wan == null )
      {
        return;
      }
      var wancopy = JSON.parse(JSON.stringify(wan));;

      /* status */
      if ( $('#status').prop('checked') == false )
      {
          wan.status = "disable";
      }
      else
      {
          if ( wan.status && wan.status != "enable" )
          {
            wan.status = "enable";
          }
          /* IPV4 */
          wan.mode = $('#mode').val();
          if ( wan.mode == "pppoec" )
          {
            if ( !wan.pppoec )
            {
              wan.pppoec = {};
            }
            wan.pppoec.custom_dns = boole2able( $('#custom_dns').prop('checked') );
            if ( wan.pppoec.custom_dns == "enable" )
            {
              wan.pppoec.dns = $('#cdns').val();
              if ( wan.pppoec.dns && check.ip(wan.pppoec.dns) == false )
              {
                  page.alert( { message: $.i18n('DNS')+" "+$.i18n('must be a valid IP address') } );
                  return;
              }
              wan.pppoec.dns2 = $('#cdns2').val();
              if ( wan.pppoec.dns2 && check.ip(wan.pppoec.dns2) == false )
              {
                  page.alert( { message: $.i18n('DNS2')+" "+$.i18n('must be a valid IP address') } );
                  return;
              }
            }
            wan.pppoec.username = $('#username').val();
            wan.pppoec.password = $('#password').val();
            wan.pppoec.lcp_echo_interval = $('#lcp_echo_interval').val();
            if ( wan.pppoec.lcp_echo_interval && check.number(wan.pppoec.lcp_echo_interval) == false )
            {
                page.alert( { message: $.i18n('LCP Echo Interval')+" "+$.i18n('must be a valid number') } );
                return;
            }
            wan.pppoec.lcp_echo_failure = $('#lcp_echo_failure').val();
            if ( wan.pppoec.lcp_echo_failure && check.number(wan.pppoec.lcp_echo_failure) == false )
            {
                page.alert( { message: $.i18n('LCP Echo Times')+" "+$.i18n('must be a valid number') } );
                return;
            }
          }
          else if ( wan.mode == "dhcpc" )
          {
            if ( !wan.dhcpc )
            {
              wan.dhcpc = {};
            }
            wan.dhcpc.routeopt = boole2able( $('#routeopt').prop('checked') );
            wan.dhcpc.custom_dns = boole2able( $('#custom_dns').prop('checked') );
            if ( wan.dhcpc.custom_dns == "enable" )
            {
              wan.dhcpc.dns = $('#cdns').val();
              if ( wan.dhcpc.dns && check.ip(wan.dhcpc.dns) == false )
              {
                  page.alert( { message: $.i18n('DNS')+" "+$.i18n('must be a valid IP address') } );
                  return;
              }
              wan.dhcpc.dns2 = $('#cdns2').val();
              if ( wan.dhcpc.dns2 && check.ip(wan.dhcpc.dns2) == false )
              {
                  page.alert( { message: $.i18n('DNS2')+" "+$.i18n('must be a valid IP address') } );
                  return;
              }
            }
          }
          else if ( wan.mode == "static" )
          {
            if ( !wan.static )
            {
                wan.static = {};
            }
            wan.static.ip = $('#ip').val();
            if ( check.ip(wan.static.ip) == false )
            {
                page.alert( { message: $.i18n('IPv4 Address')+" "+$.i18n('must be a valid IP address') } );
                return;
            }
            wan.static.mask = $('#mask').val();
            if ( check.ip(wan.static.mask) == false )
            {
                page.alert( { message: $.i18n('Subnet Mask')+" "+$.i18n('must be a valid IP address') } );
                return;
            }
            wan.static.gw = $('#gw').val();
            if ( wan.static.gw && check.ip(wan.static.gw) == false )
            {
                page.alert( { message: $.i18n('Gateway')+" "+$.i18n('must be a valid IP address') } );
                return;
            }
            wan.static.dns = $('#dns').val();
            if ( wan.static.dns && check.ip(wan.static.dns) == false )
            {
                page.alert( { message: $.i18n('DNS')+" "+$.i18n('must be a valid IP address') } );
                return;
            }
            wan.static.dns2 = $('#dns2').val();
            if ( wan.static.dns2 && check.ip(wan.static.dns2) == false )
            {
                page.alert( { message: $.i18n('DNS2')+" "+$.i18n('must be a valid IP address') } );
                return;
            }
          }
          wan.masq = boole2able( $('#masq').prop('checked') );
          wan.mtu = $('#mtu').val();
          if ( wan.mtu && check.number(wan.mtu) == false )
          {
             page.alert( { message: $.i18n('MTU')+" "+$.i18n('must be a valid number') } );
             return;
          }

          /* IPV6 */
          if ( wan.method )
          {
              wan.method = $('#method').val();
              if ( wan.method == "manual" )
              {
                if ( !wan.manual )
                {
                    wan.manual = {};
                }
                wan.manual.addr = $('#addr').val();
                if ( check.ipv6(wan.manual.addr) == false )
                {
                    page.alert( { message: $.i18n('IPv6 Address')+" "+$.i18n('must be a valid IPv6 address') } );
                    return;
                }
                wan.manual.prefix = $('#prefix').val();
                if ( wan.manual.prefix && ( wan.manual.prefix < 0 || wan.manual.prefix > 128 ) )
                {
                    page.alert( { message: $.i18n('Subnet Prefix')+" "+$.i18n('must be a number(0-128)') } );
                    return;
                }
                wan.manual.hop = $('#hop').val();
                if ( wan.manual.hop && check.ipv6(wan.manual.hop) == false )
                {
                    page.alert( { message: $.i18n('Next Hop')+" "+$.i18n('must be a valid IPv6 address') } );
                    return;
                }
                wan.manual.resolve = $('#resolve').val();
                if ( wan.manual.resolve && check.ipv6(wan.manual.resolve) == false )
                {
                    page.alert( { message: $.i18n('DNS')+" "+$.i18n('must be a valid IPv6 address') } );
                    return;
                }
                wan.manual.resolve2 = $('#resolve2').val();
                if ( wan.manual.resolve2 && check.ipv6(wan.manual.resolve2) == false )
                {
                    page.alert( { message: $.i18n('DNS2')+" "+$.i18n('must be a valid IPv6 address') } );
                    return;
                }
              }
          }
          /* Keeplive */
          if ( !wan.keeplive )
          {
            wan.keeplive = {};
          }
          wan.keeplive.type = $('#keeplive').val();
          if ( wan.keeplive.type == "icmp" )
          {
            if ( !wan.keeplive.icmp )
            {
              wan.keeplive.icmp = {};
            }
            if ( !wan.keeplive.icmp.dest )
            {
              wan.keeplive.icmp.dest = {};
            }
            wan.keeplive.icmp.dest.test = $('#icmp_test').val();
            if ( !wan.keeplive.icmp.dest.test )
            {
                page.alert( { message: $.i18n('Test Address')+" "+$.i18n('Can not be empty') } );
                return;
            }
            wan.keeplive.icmp.dest.test2 = $('#icmp_test2').val();
            wan.keeplive.icmp.dest.test3 = $('#icmp_test3').val();
            wan.keeplive.icmp.timeout = $('#icmp_timeout').val();
            if ( check.number(wan.keeplive.icmp.timeout) == false )
            {
                page.alert( { message: $.i18n('Each Query Timeout(sec)')+" "+$.i18n('must be a valid number') } );
                return;
            }
            wan.keeplive.icmp.failed = $('#icmp_failed').val();
            if ( check.number(wan.keeplive.icmp.failed) == false )
            {
                page.alert( { message: $.i18n('Test Times')+" "+$.i18n('must be a valid number') } );
                return;
            }
            wan.keeplive.icmp.interval = $('#icmp_interval').val();
            if ( check.number(wan.keeplive.icmp.interval) == false )
            {
                page.alert( { message: $.i18n('Test Interval(sec)')+" "+$.i18n('must be a valid number') } );
                return;
            }
          }
          if ( wan.keeplive.type == "dns" || wan.keeplive.type == "auto" )
          {
            if ( !wan.keeplive.dns )
            {
              wan.keeplive.dns = {};
            }
            wan.keeplive.dns.timeout = $('#dns_timeout').val();
            if ( check.number(wan.keeplive.dns.timeout) == false )
            {
                page.alert( { message: $.i18n('Each Query Timeout(sec)')+" "+$.i18n('must be a valid number') } );
                return;
            }
            wan.keeplive.dns.failed = $('#dns_failed').val();
            if ( check.number(wan.keeplive.dns.failed) == false )
            {
                page.alert( { message: $.i18n('Query Times')+" "+$.i18n('must be a valid number') } );
                return;
            }
            wan.keeplive.dns.interval = $('#dns_interval').val();
            if ( check.number(wan.keeplive.dns.interval) == false )
            {
                page.alert( { message: $.i18n('Query Interval(sec)')+" "+$.i18n('must be a valid number') } );
                return;
            }
          }
          if ( wan.keeplive.type == "recv" || wan.keeplive.type == "auto" )
          {
            if ( !wan.keeplive.recv )
            {
              wan.keeplive.recv = {};
            }
            wan.keeplive.recv.timeout = $('#recv_timeout').val();
            if ( check.number(wan.keeplive.recv.timeout) == false )
            {
                page.alert( { message: $.i18n('Count Duration(sec)')+" "+$.i18n('must be a valid number') } );
                return;
            }
            wan.keeplive.recv.failed = $('#recv_failed').val();
            if ( check.number(wan.keeplive.recv.failed) == false )
            {
                page.alert( { message: $.i18n('Count Times')+" "+$.i18n('must be a valid number') } );
                return;
            }
            wan.keeplive.recv.packets = $('#recv_packets').val();
            if ( check.number(wan.keeplive.recv.packets) == false )
            {
                page.alert( { message: $.i18n('Received packets')+" "+$.i18n('must be a valid number') } );
                return;
            }
          }
      }

      if ( ocompare( wan, wancopy ) )
      {
          page.alert( { message: $.i18n('Settings unchanged') } );
          return;
      }
      page.confirm( { message: $.i18n('The WAN connecttion will be disconneted because of the change of configuration') } ).then( function(result){
        if ( result )
        {
          he.save( [ object+"="+JSON.stringify(wan)] ).then( function(){
            page.hint2succeed( $.i18n('Modify successfully') );
            config_load();
          });
        }
      });
    }



    /* init */
    page.password('password', 'password-icon' );
    $.i18n().load( page.lang('wan') ).then( function () {
        /* init the langauage */
        $.i18n().locale = lang; $('body').i18n();

        /* load the configure */
        status_load();
        config_load();

        $('#wan_btn').on(ace.click_event, function () {
            if ( wans.status == "down" )
            {
                he.exec( [ object+'.setup' ] ).then( function(result){status_load();} );
            }
            else
            {
                he.exec( [ object+'.shut' ] ).then( function(result){status_load();} );
            }
        });

        // 设置定时器
        page.timing({
          refresh: function ()
          {
              status_load();
          },
          interval: 1000
        });

        /* bind the refresh */
        $('#refresh').on(ace.click_event, function () {
            location.reload();
        });
        /* bind the apply */
        $('#apply').on(ace.click_event, function () {
            config_save();
        });
    });

  })();
</script>
